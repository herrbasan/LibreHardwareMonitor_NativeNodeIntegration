# LibreHardwareMonitor Native Node Integration

Direct hardware monitoring integration for Node.js and Electron projects, providing native access to LibreHardwareMonitor sensor data through a Node.js addon.

> **ğŸ¤– AI-Generated Project**: 100% of this project's code was generated by [Claude Sonnet 4.5](https://www.anthropic.com/claude), including the native C++ addon, C# bridge, build scripts, tests, and documentation. This demonstrates the current capabilities of large language models in complex, multi-language software development involving low-level system programming and native interop.

## ğŸ¯ Project Goals

**Priority Ranking**: Reliability > Low Footprint > Performance

- âœ… Produce identical JSON structure to LibreHardwareMonitor web server endpoint (`/data.json`)
- âœ… Provide drop-in replacement for web-based polling implementations
- âœ… Eliminate external process dependency on LibreHardwareMonitor.exe
- âœ… High reliability with graceful degradation on failures
- âœ… Minimal memory and CPU footprint

## ğŸ“‹ Prerequisites

### System Requirements

- **Operating System**: Windows 10/11 (64-bit)
- **Node.js**: v16.0.0 or later
- **.NET Runtime**: 6.0 or later ([Download](https://dotnet.microsoft.com/download/dotnet/6.0))
- **Administrator Privileges**: Required for hardware access (LibreHardwareMonitor limitation)

### Build Requirements

To build from source, you need:

1. **Visual Studio 2019 or later** with:
   - Desktop development with C++ workload
   - Windows 10/11 SDK
   - MSVC v142+ compiler toolset
   - ğŸ“– **[Detailed Visual Studio Setup Guide](docs/VISUAL_STUDIO_SETUP.md)**

2. **.NET SDK 6.0 or later** ([Download](https://dotnet.microsoft.com/download/dotnet/6.0))

3. **Python 3.x** (required by node-gyp)

## ğŸš€ Quick Start

### Installation Options

#### Option 1: Pre-built Distribution (Easiest - No Build Tools Required!)

Download the latest release `.zip` file from [GitHub Releases](https://github.com/herrbasan/LibreHardwareMonitor_NativeNodeIntegration/releases) and extract it.

**Requirements**: Windows 10/11, Node.js 16+, [.NET Runtime 6.0+](https://dotnet.microsoft.com/download/dotnet/6.0)

```javascript
const monitor = require('./path/to/dist');
await monitor.init({ cpu: true, gpu: true });
const data = await monitor.poll();
```

No Visual Studio, Python, or build tools needed!

#### Option 2: Build from Source

```bash
# Clone the repository with submodules
git clone --recurse-submodules https://github.com/herrbasan/LibreHardwareMonitor_NativeNodeIntegration.git
cd LibreHardwareMonitor_NativeNodeIntegration

# Install dependencies and build
npm install
```

**Requires**: Visual Studio 2019+, .NET SDK 6.0+, Python 3.x

### Usage Example

```javascript
const monitor = require('librehardwaremonitor-native');

async function main() {
    // Initialize with desired hardware types
    await monitor.init({
        cpu: true,
        gpu: true,
        motherboard: true,
        memory: true,
        storage: false  // Disable storage monitoring
    });
    
    // Poll sensors
    const data = await monitor.poll();
    console.log(JSON.stringify(data, null, 2));
    
    // Cleanup on exit
    await monitor.shutdown();
}

main().catch(console.error);
```

### Running as Administrator

LibreHardwareMonitor **requires elevated privileges** to access hardware sensors. Your application must run as Administrator.

**For development**:
```powershell
# PowerShell (run from elevated prompt)
Start-Process code -Verb RunAs
```

**For production** (Electron apps):
Add to your `app.manifest`:
```xml
<requestedExecutionLevel level="requireAdministrator" uiAccess="false" />
```

## ğŸ—ï¸ Architecture

```
Native Node.js Addon (C++)
    â†“ (Node-API interface)
CLR Host Layer (embeds .NET runtime)
    â†“
LibreHardwareMonitorLib.dll
    â†“
PawnIO Kernel Driver (embedded resources)
    â†“
Hardware (CPU, GPU, Motherboard, etc.)
```

### Technology Stack

- **Node-API (N-API)**: Stable ABI for cross-version compatibility
- **CLR Hosting**: CoreCLR hosting APIs to embed .NET runtime
- **LibreHardwareMonitor**: C# library with PawnIO driver (secure replacement for WinRing0)
- **Git Submodule**: Pins LibreHardwareMonitor to specific commit with PawnIO support

## ğŸ“ Project Structure

```
librehardwaremonitor-native/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ copilot-instructions.md    # Comprehensive implementation guide
â”œâ”€â”€ binding.gyp                    # Native addon build config
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ addon.cc                   # Node-API entry point
â”‚   â”œâ”€â”€ clr_host.cc/.h             # .NET runtime hosting
â”‚   â”œâ”€â”€ hardware_monitor.cc/.h     # LibreHardwareMonitor wrapper
â”‚   â””â”€â”€ json_builder.cc/.h         # Data marshaling to JSON
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ index.js                   # JavaScript interface
â”œâ”€â”€ deps/
â”‚   â”œâ”€â”€ LibreHardwareMonitor/      # Built DLLs (generated)
â”‚   â””â”€â”€ LibreHardwareMonitor-src/  # Git submodule (source code)
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ build-lhm.js               # LibreHardwareMonitor build automation
â”œâ”€â”€ test/
â”‚   â””â”€â”€ basic.js                   # Basic functionality test
â””â”€â”€ example/
    â””â”€â”€ librehardwaremonitor_webservice_output.json  # Reference format
```

## ğŸ”§ Development

### Building

```bash
# Build everything
npm run build

# Build LibreHardwareMonitor DLLs only
npm run build:lhm

# Build native addon only
npm run build:native

# Clean build artifacts
npm run clean

# Full rebuild
npm run rebuild
```

### Creating Distribution Package

To create a pre-built distribution for sharing (no build tools required for users):

```bash
# Build everything first
npm run build

# Create distribution package
npm run dist
```

This creates:
- `dist/` folder (4.3 MB) - Ready to use, all binaries included
- `librehardwaremonitor-native-v{version}-win64.zip` (1.5 MB) - Compressed archive

Users can extract and use immediately:
```javascript
const monitor = require('./dist');
await monitor.init({ cpu: true, gpu: true });
```

### Testing

```bash
# Run basic test (requires Administrator privileges)
npm test

# Test distribution package
node test/test-dist.js

# Test flattening feature
node test/test-flatten.js
```

### Current Status

**âœ… Completed (Phase 2)**:
- Build infrastructure with git submodule
- LibreHardwareMonitor compilation automation
- Native addon skeleton with Node-API
- CLR hosting layer foundation
- JavaScript interface API
- **Full CLR runtime integration**
- **Real hardware sensor polling**
- **JSON format matching web endpoint**
- **Optional flattening feature**
- **Pre-built distribution packages**

**ğŸš§ In Progress (Phase 2)**:
- CLR runtime initialization with proper config
- Loading LibreHardwareMonitor.dll and creating Computer instance
- Sensor polling via managed code
- JSON data marshaling to match web endpoint format

**ğŸ“‹ Planned (Phase 3+)**:
- Async polling with libuv thread pool
- Comprehensive error handling
- Memory leak detection and prevention
- Multi-hardware configuration testing
- Production deployment

## ğŸ” Security Considerations

### Administrator Privileges

LibreHardwareMonitor **cannot function without elevated privileges** due to:
- Ring-0 kernel driver access (PawnIO)
- Direct hardware I/O port access
- MSR (Model-Specific Register) reads
- SMBus communication for motherboard sensors

Your application **must** enforce elevation at launch.

### PawnIO Driver

- PawnIO replaced WinRing0 due to security vulnerabilities
- Driver modules are embedded as resources in `LibreHardwareMonitorLib.dll`
- Modules are extracted and loaded at runtime
- Windows verifies driver signatures

### Best Practices

- âœ… Use code signing for production releases
- âœ… Validate all input to native addon
- âœ… Implement audit logging for hardware access
- âœ… Minimize elevated code surface area
- âœ… Keep LibreHardwareMonitor submodule updated

## ğŸ“Š JSON Output Format

The addon produces **byte-identical** output to LibreHardwareMonitor's web endpoint:

```json
{
  "id": 0,
  "Text": "Sensor",
  "Children": [
    {
      "id": 1,
      "Text": "AMD Ryzen 9 5900X",
      "Children": [
        {
          "id": 2,
          "Text": "Temperatures",
          "Children": [
            {
              "id": 3,
              "Text": "Core (Tctl/Tdie)",
              "Min": "35.0 Â°C",
              "Value": "45.5 Â°C",
              "Max": "78.0 Â°C"
            }
          ]
        }
      ]
    }
  ]
}
```

See `example/librehardwaremonitor_webservice_output.json` for full reference.

## ğŸ› Troubleshooting

### Build Errors

**Problem**: `Visual Studio not found`
```
Solution: Install Visual Studio 2019+ with "Desktop development with C++" workload
Or: Install Build Tools for Visual Studio (standalone)
```

**Problem**: `.NET SDK not found`
```
Solution: Install .NET SDK 6.0 or later
Verify: dotnet --version
```

**Problem**: `Python not found`
```
Solution: Install Python 3.x and add to PATH
Verify: python --version
```

### Runtime Errors

**Problem**: `ACCESS_DENIED` or initialization fails
```
Solution: Run application as Administrator
Development: Right-click VS Code â†’ "Run as administrator"
Production: Add requireAdministrator to app manifest
```

**Problem**: `CLR_INIT_FAILED`
```
Solution: Install .NET Runtime 6.0 or later
Download: https://dotnet.microsoft.com/download/dotnet/6.0
```

**Problem**: Missing sensors
```
Not an error - hardware may not support all sensors
Compare with standalone LibreHardwareMonitor.exe output
Ensure correct hardware types enabled in init() config
```

## ğŸ“ License

MIT License - See LICENSE file for details

### Third-Party Licenses

- **LibreHardwareMonitor**: MPL 2.0 ([License](https://github.com/LibreHardwareMonitor/LibreHardwareMonitor/blob/master/LICENSE))
- **HidSharp**: Apache 2.0
- **Node-API**: MIT (part of Node.js)

## ğŸ™ Credits

- [LibreHardwareMonitor](https://github.com/LibreHardwareMonitor/LibreHardwareMonitor) - Hardware monitoring library
- [Node-API](https://nodejs.org/api/n-api.html) - Native addon interface
- [PawnIO](https://github.com/adspro15/PawnIO) - Secure kernel driver

## ğŸ¤ Contributing

Contributions welcome! Please read the implementation guide in `.github/copilot-instructions.md` for technical details.

### Development Workflow

1. Check instructions in `.github/copilot-instructions.md`
2. Create feature branch
3. Make changes with tests
4. Ensure builds successfully
5. Submit pull request

## ğŸ“š Additional Resources

- [Implementation Guide](.github/copilot-instructions.md) - Complete technical specifications
- [LibreHardwareMonitor Docs](https://github.com/LibreHardwareMonitor/LibreHardwareMonitor/wiki)
- [Node-API Documentation](https://nodejs.org/api/n-api.html)
- [CLR Hosting Guide](https://learn.microsoft.com/en-us/dotnet/core/tutorials/netcore-hosting)

---

**Status**: Phase 1 Complete - Build infrastructure ready  
**Next**: Implement CLR initialization and LibreHardwareMonitor integration
